using System;
using System.Collections.Generic;
using System.IO;
using System.Linq;
using System.Threading.Tasks;
using Microsoft.AspNetCore.Http;
using Microsoft.AspNetCore.Mvc;
using Newtonsoft.Json;
using Newtonsoft.Json.Linq;
using Weather.Models;

namespace Weather.Controllers
{
    [Route("api/[controller]")]
    [ApiController]
    public class Weather : ControllerBase
    {


        //public ICollection<string> RunWeather()
        //{
        //    var weatherTask = Task.Run<ICollection<string>>(async () => await ProvideWeatherData());
        //    return weatherTask.Result;
        //}

        [HttpGet]

        public async Task<ICollection<string>> ProvideWeatherData()
        {
            // This method gets called once when your solution starts running. Place your code in this method.

            List<string> weatherData = ReadWeatherData();

            foreach (var item in weatherData)
            {

                var result = JsonConvert.DeserializeObject<RootClass>(item);
                //var weatherInfo = JSONDeserialize(item, typeof(String));
            }
            // return final result as list of strings
            return await Task.FromResult(weatherData);
        }

        public static object JSONDeserialize(string jsonText, Type valueType)
        {
            // HTML-decode the string, in case it has been HTML encoded
            jsonText = System.Web.HttpUtility.HtmlDecode(jsonText);

            Newtonsoft.Json.JsonSerializer json = new Newtonsoft.Json.JsonSerializer();

            json.NullValueHandling = Newtonsoft.Json.NullValueHandling.Ignore;
            json.ObjectCreationHandling = Newtonsoft.Json.ObjectCreationHandling.Replace;
            json.MissingMemberHandling = Newtonsoft.Json.MissingMemberHandling.Ignore;
            json.ReferenceLoopHandling = Newtonsoft.Json.ReferenceLoopHandling.Ignore;

            StringReader sr = new StringReader(jsonText);
            Newtonsoft.Json.JsonTextReader reader = new JsonTextReader(sr);
            object result = json.Deserialize(reader, valueType);
            reader.Close();

            return result;
        }
        private List<string> ReadWeatherData()
        {
            List<string> weatherData = new List<string>();
            weatherData.Add("{​​​​​​​\"consolidated_weather\":[{​​​​​​​\"id\":5744519607746560,\"weather_state_name\":\"Light Cloud\",\"weather_state_abbr\":\"lc\",\"wind_direction_compass\":\"WSW\",\"created\":\"2019-03-28T16:47:26.255553Z\",\"applicable_date\":\"2019-03-28\",\"min_temp\":9.445,\"max_temp\":21.259999999999998,\"the_temp\":19.634999999999998,\"wind_speed\":3.608262087276969,\"wind_direction\":243.18781768037604,\"air_pressure\":1022.4,\"humidity\":60,\"visibility\":14.72742931281317,\"predictability\":70}​​​​​​​,{​​​​​​​\"id\":4985309714448384,\"weather_state_name\":\"Light Cloud\",\"weather_state_abbr\":\"lc\",\"wind_direction_compass\":\"WNW\",\"created\":\"2019-03-28T16:47:28.641484Z\",\"applicable_date\":\"2019-03-29\",\"min_temp\":7.075,\"max_temp\":22.189999999999998,\"the_temp\":18.985,\"wind_speed\":2.9227146194702933,\"wind_direction\":292.6992699564693,\"air_pressure\":1021.5350000000001,\"humidity\":42,\"visibility\":15.085960490734113,\"predictability\":70}​​​​​​​,{​​​​​​​\"id\":5756582761594880,\"weather_state_name\":\"Clear\",\"weather_state_abbr\":\"c\",\"wind_direction_compass\":\"NNW\",\"created\":\"2019-03-28T16:47:31.945771Z\",\"applicable_date\":\"2019-03-30\",\"min_temp\":6.545,\"max_temp\":25.025,\"the_temp\":21.665,\"wind_speed\":2.715901616636178,\"wind_direction\":336.7272733618126,\"air_pressure\":1018.96,\"humidity\":34,\"visibility\":15.746478068082398,\"predictability\":68}​​​​​​​,{​​​​​​​\"id\":6164672535330816,\"weather_state_name\":\"Light Cloud\",\"weather_state_abbr\":\"lc\",\"wind_direction_compass\":\"NNW\",\"created\":\"2019-03-28T16:47:35.099357Z\",\"applicable_date\":\"2019-03-31\",\"min_temp\":11.620000000000001,\"max_temp\":27.755,\"the_temp\":25.0,\"wind_speed\":3.148169387276969,\"wind_direction\":343.1282295803181,\"air_pressure\":1017.26,\"humidity\":26,\"visibility\":16.186098186590314,\"predictability\":70}​​​​​​​,{​​​​​​​\"id\":5580722607751168,\"weather_state_name\":\"Light Cloud\",\"weather_state_abbr\":\"lc\",\"wind_direction_compass\":\"SW\",\"created\":\"2019-03-28T16:47:38.130584Z\",\"applicable_date\":\"2019-04-01\",\"min_temp\":13.165,\"max_temp\":28.43,\"the_temp\":24.725,\"wind_speed\":2.2151460066544715,\"wind_direction\":235.6869469586183,\"air_pressure\":1014.3399999999999,\"humidity\":28,\"visibility\":15.984152549113178,\"predictability\":70}​​​​​​​,{​​​​​​​\"id\":4834264304582656,\"weather_state_name\":\"Light Cloud\",\"weather_state_abbr\":\"lc\",\"wind_direction_compass\":\"SW\",\"created\":\"2019-03-28T16:47:40.617570Z\",\"applicable_date\":\"2019-04-02\",\"min_temp\":12.205,\"max_temp\":24.105,\"the_temp\":20.34,\"wind_speed\":2.2794255547602007,\"wind_direction\":218.0,\"air_pressure\":1014.86,\"humidity\":45,\"visibility\":9.997862483098704,\"predictability\":70}​​​​​​​],\"time\":\"2019-03-28T12:38:16.884107-07:00\",\"sun_rise\":\"2019-03-28T06:45:55.917436-07:00\",\"sun_set\":\"2019-03-28T19:09:56.208069-07:00\",\"timezone_name\":\"LMT\",\"parent\":{​​​​​​​\"title\":\"California\",\"location_type\":\"Region / State / Province\",\"woeid\":2347563,\"latt_long\":\"37.271881,-119.270233\"}​​​​​​​,\"sources\":[{​​​​​​​\"title\":\"BBC\",\"slug\":\"bbc\",\"url\":\"http://www.bbc.co.uk/weather/\",\"crawl_rate\":180}​​​​​​​,{​​​​​​​\"title\":\"Forecast.io\",\"slug\":\"forecast-io\",\"url\":\"http://forecast.io/\",\"crawl_rate\":480}​​​​​​​,{​​​​​​​\"title\":\"HAMweather\",\"slug\":\"hamweather\",\"url\":\"http://www.hamweather.com/\",\"crawl_rate\":360}​​​​​​​,{​​​​​​​\"title\":\"Met Office\",\"slug\":\"met-office\",\"url\":\"http://www.metoffice.gov.uk/\",\"crawl_rate\":180}​​​​​​​,{​​​​​​​\"title\":\"OpenWeatherMap\",\"slug\":\"openweathermap\",\"url\":\"http://openweathermap.org/\",\"crawl_rate\":360}​​​​​​​,{​​​​​​​\"title\":\"Weather Underground\",\"slug\":\"wunderground\",\"url\":\"https://www.wunderground.com/?apiref=fc30dc3cd224e19b\",\"crawl_rate\":720}​​​​​​​,{​​​​​​​\"title\":\"World Weather Online\",\"slug\":\"world-weather-online\",\"url\":\"http://www.worldweatheronline.com/\",\"crawl_rate\":360}​​​​​​​,{​​​​​​​\"title\":\"Yahoo\",\"slug\":\"yahoo\",\"url\":\"http://weather.yahoo.com/\",\"crawl_rate\":180}​​​​​​​],\"title\":\"Los Angeles\",\"location_type\":\"City\",\"woeid\":2442047,\"latt_long\":\"34.053490,-118.245323\",\"timezone\":\"US/Pacific\"}​​​​​​​");
            weatherData.Add("{​​​​​​​\"consolidated_weather\":[{​​​​​​​\"id\":5838918358401024,\"weather_state_name\":\"Light Cloud\",\"weather_state_abbr\":\"lc\",\"wind_direction_compass\":\"S\",\"created\":\"2019-03-28T16:44:44.722535Z\",\"applicable_date\":\"2019-03-28\",\"min_temp\":0.195,\"max_temp\":5.97,\"the_temp\":5.29,\"wind_speed\":6.176262557117103,\"wind_direction\":173.70645757364878,\"air_pressure\":1030.8200000000002,\"humidity\":72,\"visibility\":15.190972222222221,\"predictability\":70}​​​​​​​,{​​​​​​​\"id\":4826461758291968,\"weather_state_name\":\"Heavy Cloud\",\"weather_state_abbr\":\"hc\",\"wind_direction_compass\":\"SSW\",\"created\":\"2019-03-28T16:44:46.617238Z\",\"applicable_date\":\"2019-03-29\",\"min_temp\":3.655,\"max_temp\":14.055,\"the_temp\":12.415,\"wind_speed\":5.224863268885708,\"wind_direction\":204.05092745106305,\"air_pressure\":1024.28,\"humidity\":68,\"visibility\":10.330296070945678,\"predictability\":71}​​​​​​​,{​​​​​​​\"id\":6430916383604736,\"weather_state_name\":\"Heavy Cloud\",\"weather_state_abbr\":\"hc\",\"wind_direction_compass\":\"S\",\"created\":\"2019-03-28T16:44:50.722289Z\",\"applicable_date\":\"2019-03-30\",\"min_temp\":8.969999999999999,\"max_temp\":17.115,\"the_temp\":16.035,\"wind_speed\":6.777029364171903,\"wind_direction\":189.92550941525553,\"air_pressure\":1017.69,\"humidity\":65,\"visibility\":14.696671438797422,\"predictability\":71}​​​​​​​,{​​​​​​​\"id\":5275968404979712,\"weather_state_name\":\"Light Rain\",\"weather_state_abbr\":\"lr\",\"wind_direction_compass\":\"W\",\"created\":\"2019-03-28T16:44:52.616788Z\",\"applicable_date\":\"2019-03-31\",\"min_temp\":6.29,\"max_temp\":14.825,\"the_temp\":14.489999999999998,\"wind_speed\":7.253414885582863,\"wind_direction\":278.0053901175198,\"air_pressure\":1012.64,\"humidity\":66,\"visibility\":9.306587031734669,\"predictability\":75}​​​​​​​,{​​​​​​​\"id\":6558206782341120,\"weather_state_name\":\"Heavy Cloud\",\"weather_state_abbr\":\"hc\",\"wind_direction_compass\":\"N\",\"created\":\"2019-03-28T16:44:55.700735Z\",\"applicable_date\":\"2019-04-01\",\"min_temp\":2.605,\"max_temp\":8.39,\"the_temp\":6.904999999999999,\"wind_speed\":8.75500498580026,\"wind_direction\":8.2263808621933,\"air_pressure\":1025.06,\"humidity\":36,\"visibility\":16.325285333651475,\"predictability\":71}​​​​​​​,{​​​​​​​\"id\":4610375410515968,\"weather_state_name\":\"Light Rain\",\"weather_state_abbr\":\"lr\",\"wind_direction_compass\":\"ENE\",\"created\":\"2019-03-28T16:44:58.710810Z\",\"applicable_date\":\"2019-04-02\",\"min_temp\":3.6500000000000004,\"max_temp\":7.765000000000001,\"the_temp\":6.44,\"wind_speed\":7.34952119621411,\"wind_direction\":64.50000000000001,\"air_pressure\":1017.44,\"humidity\":42,\"visibility\":9.997862483098704,\"predictability\":75}​​​​​​​],\"time\":\"2019-03-28T15:38:55.499445-04:00\",\"sun_rise\":\"2019-03-28T06:46:34.652723-04:00\",\"sun_set\":\"2019-03-28T19:16:22.536389-04:00\",\"timezone_name\":\"LMT\",\"parent\":{​​​​​​​\"title\":\"New York\",\"location_type\":\"Region / State / Province\",\"woeid\":2347591,\"latt_long\":\"42.855350,-76.501671\"}​​​​​​​,\"sources\":[{​​​​​​​\"title\":\"BBC\",\"slug\":\"bbc\",\"url\":\"http://www.bbc.co.uk/weather/\",\"crawl_rate\":180}​​​​​​​,{​​​​​​​\"title\":\"Forecast.io\",\"slug\":\"forecast-io\",\"url\":\"http://forecast.io/\",\"crawl_rate\":480}​​​​​​​,{​​​​​​​\"title\":\"HAMweather\",\"slug\":\"hamweather\",\"url\":\"http://www.hamweather.com/\",\"crawl_rate\":360}​​​​​​​,{​​​​​​​\"title\":\"Met Office\",\"slug\":\"met-office\",\"url\":\"http://www.metoffice.gov.uk/\",\"crawl_rate\":180}​​​​​​​,{​​​​​​​\"title\":\"OpenWeatherMap\",\"slug\":\"openweathermap\",\"url\":\"http://openweathermap.org/\",\"crawl_rate\":360}​​​​​​​,{​​​​​​​\"title\":\"Weather Underground\",\"slug\":\"wunderground\",\"url\":\"https://www.wunderground.com/?apiref=fc30dc3cd224e19b\",\"crawl_rate\":720}​​​​​​​,{​​​​​​​\"title\":\"World Weather Online\",\"slug\":\"world-weather-online\",\"url\":\"http://www.worldweatheronline.com/\",\"crawl_rate\":360}​​​​​​​,{​​​​​​​\"title\":\"Yahoo\",\"slug\":\"yahoo\",\"url\":\"http://weather.yahoo.com/\",\"crawl_rate\":180}​​​​​​​],\"title\":\"New York\",\"location_type\":\"City\",\"woeid\":2459115,\"latt_long\":\"40.71455,-74.007118\",\"timezone\":\"US/Eastern\"}​​​​​​​");
            weatherData.Add("{​​​​​​​\"consolidated_weather\":[{​​​​​​​\"id\":4840240013377536,\"weather_state_name\":\"Light Cloud\",\"weather_state_abbr\":\"lc\",\"wind_direction_compass\":\"NE\",\"created\":\"2019-03-28T16:44:01.846868Z\",\"applicable_date\":\"2019-03-28\",\"min_temp\":3.74,\"max_temp\":16.240000000000002,\"the_temp\":14.515,\"wind_speed\":1.8648151731673692,\"wind_direction\":47.14921354773719,\"air_pressure\":1036.1950000000002,\"humidity\":60,\"visibility\":9.258430764336275,\"predictability\":70}​​​​​​​,{​​​​​​​\"id\":6158451006767104,\"weather_state_name\":\"Clear\",\"weather_state_abbr\":\"c\",\"wind_direction_compass\":\"SSW\",\"created\":\"2019-03-28T16:44:02.152811Z\",\"applicable_date\":\"2019-03-29\",\"min_temp\":2.6300000000000003,\"max_temp\":17.42,\"the_temp\":14.85,\"wind_speed\":3.643597925077547,\"wind_direction\":210.49417758662082,\"air_pressure\":1030.205,\"humidity\":58,\"visibility\":10.435307802433787,\"predictability\":68}​​​​​​​,{​​​​​​​\"id\":5139251006013440,\"weather_state_name\":\"Light Cloud\",\"weather_state_abbr\":\"lc\",\"wind_direction_compass\":\"W\",\"created\":\"2019-03-28T16:44:02.624632Z\",\"applicable_date\":\"2019-03-30\",\"min_temp\":3.83,\"max_temp\":16.88,\"the_temp\":15.67,\"wind_speed\":2.295554574060818,\"wind_direction\":262.5310891230524,\"air_pressure\":1023.105,\"humidity\":59,\"visibility\":10.351733377077865,\"predictability\":70}​​​​​​​,{​​​​​​​\"id\":5037364718075904,\"weather_state_name\":\"Light Cloud\",\"weather_state_abbr\":\"lc\",\"wind_direction_compass\":\"ENE\",\"created\":\"2019-03-28T16:44:02.818830Z\",\"applicable_date\":\"2019-03-31\",\"min_temp\":5.485,\"max_temp\":11.955,\"the_temp\":11.38,\"wind_speed\":8.283680469471621,\"wind_direction\":63.25645999139108,\"air_pressure\":1027.325,\"humidity\":59,\"visibility\":11.435715421935894,\"predictability\":70}​​​​​​​,{​​​​​​​\"id\":4961017379422208,\"weather_state_name\":\"Light Cloud\",\"weather_state_abbr\":\"lc\",\"wind_direction_compass\":\"NE\",\"created\":\"2019-03-28T16:44:03.005036Z\",\"applicable_date\":\"2019-04-01\",\"min_temp\":1.22,\"max_temp\":12.325,\"the_temp\":12.19,\"wind_speed\":3.0280336601049878,\"wind_direction\":53.74059391969584,\"air_pressure\":1030.115,\"humidity\":54,\"visibility\":14.510260081126223,\"predictability\":70}​​​​​​​,{​​​​​​​\"id\":5559481041682432,\"weather_state_name\":\"Light Cloud\",\"weather_state_abbr\":\"lc\",\"wind_direction_compass\":\"SW\",\"created\":\"2019-03-28T16:44:04.701854Z\",\"applicable_date\":\"2019-04-02\",\"min_temp\":2.035,\"max_temp\":12.565,\"the_temp\":14.28,\"wind_speed\":5.81588940586972,\"wind_direction\":214.0,\"air_pressure\":1030.2,\"humidity\":62,\"visibility\":7.18305098226358,\"predictability\":70}​​​​​​​],\"time\":\"2019-03-28T19:41:06.318115Z\",\"sun_rise\":\"2019-03-28T05:45:50.917439Z\",\"sun_set\":\"2019-03-28T18:26:31.803799Z\",\"timezone_name\":\"LMT\",\"parent\":{​​​​​​​\"title\":\"England\",\"location_type\":\"Region / State / Province\",\"woeid\":24554868,\"latt_long\":\"52.883560,-1.974060\"}​​​​​​​,\"sources\":[{​​​​​​​\"title\":\"BBC\",\"slug\":\"bbc\",\"url\":\"http://www.bbc.co.uk/weather/\",\"crawl_rate\":180}​​​​​​​,{​​​​​​​\"title\":\"Forecast.io\",\"slug\":\"forecast-io\",\"url\":\"http://forecast.io/\",\"crawl_rate\":480}​​​​​​​,{​​​​​​​\"title\":\"HAMweather\",\"slug\":\"hamweather\",\"url\":\"http://www.hamweather.com/\",\"crawl_rate\":360}​​​​​​​,{​​​​​​​\"title\":\"Met Office\",\"slug\":\"met-office\",\"url\":\"http://www.metoffice.gov.uk/\",\"crawl_rate\":180}​​​​​​​,{​​​​​​​\"title\":\"OpenWeatherMap\",\"slug\":\"openweathermap\",\"url\":\"http://openweathermap.org/\",\"crawl_rate\":360}​​​​​​​,{​​​​​​​\"title\":\"Weather Underground\",\"slug\":\"wunderground\",\"url\":\"https://www.wunderground.com/?apiref=fc30dc3cd224e19b\",\"crawl_rate\":720}​​​​​​​,{​​​​​​​\"title\":\"World Weather Online\",\"slug\":\"world-weather-online\",\"url\":\"http://www.worldweatheronline.com/\",\"crawl_rate\":360}​​​​​​​,{​​​​​​​\"title\":\"Yahoo\",\"slug\":\"yahoo\",\"url\":\"http://weather.yahoo.com/\",\"crawl_rate\":180}​​​​​​​],\"title\":\"London\",\"location_type\":\"City\",\"woeid\":44418,\"latt_long\":\"51.506321,-0.12714\",\"timezone\":\"Europe/London\"}​​​​​​​");
            return weatherData;
        }
    }
}
